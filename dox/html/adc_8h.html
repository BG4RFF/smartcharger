<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BatteryCharger: adc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BatteryCharger
   &#160;<span id="projectnumber">5.0</span>
   </div>
   <div id="projectbrief">A smart charger for lead-acid batteries.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('adc_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">adc.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="adc_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab1d0fe407755d6fc628d014d7d0bcd8d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#ab1d0fe407755d6fc628d014d7d0bcd8d">ADC_CLK_FREQ</a>&#160;&#160;&#160;1000000</td></tr>
<tr class="separator:ab1d0fe407755d6fc628d014d7d0bcd8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa34423f95e31d610503eaa953906d93c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#aa34423f95e31d610503eaa953906d93c">VREF_25_CHANNEL</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aa34423f95e31d610503eaa953906d93c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a501e37e951966e98511c9c1eb0c7d397"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a501e37e951966e98511c9c1eb0c7d397">CURRENT_CHANNEL</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a501e37e951966e98511c9c1eb0c7d397"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ad11a109af35fa8de5e0b1b3e60142b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a3ad11a109af35fa8de5e0b1b3e60142b">VOLTAGE_CHANNEL</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a3ad11a109af35fa8de5e0b1b3e60142b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c77a4467697f72f3d6ed3b5effd7182"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a1c77a4467697f72f3d6ed3b5effd7182">ADC_VREF_MV</a>&#160;&#160;&#160;3300</td></tr>
<tr class="separator:a1c77a4467697f72f3d6ed3b5effd7182"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae678d504181814806fe8acf281cb7c31"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#ae678d504181814806fe8acf281cb7c31">ADC_BITS</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ae678d504181814806fe8acf281cb7c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1f09871849e533aea252fc78a2aa84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a4a1f09871849e533aea252fc78a2aa84">IOCON_ADC0PIN</a>&#160;&#160;&#160;R_PIO0_11</td></tr>
<tr class="separator:a4a1f09871849e533aea252fc78a2aa84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a267ec9fac11562467240f0b3627288a0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a267ec9fac11562467240f0b3627288a0">IOCON_ADC1PIN</a>&#160;&#160;&#160;R_PIO1_0</td></tr>
<tr class="separator:a267ec9fac11562467240f0b3627288a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc40c992fe2ad9bd0f6e7718c3acb3e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#acc40c992fe2ad9bd0f6e7718c3acb3e0">IOCON_ADC2PIN</a>&#160;&#160;&#160;R_PIO1_1</td></tr>
<tr class="separator:acc40c992fe2ad9bd0f6e7718c3acb3e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a506159826be18b45611deae145462433"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a506159826be18b45611deae145462433">IOCON_ADC3PIN</a>&#160;&#160;&#160;R_PIO1_2</td></tr>
<tr class="separator:a506159826be18b45611deae145462433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a967a470d2db12070ac476ff8997e8265"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a967a470d2db12070ac476ff8997e8265">IOCON_ADC4PIN</a>&#160;&#160;&#160;SWDIO_PIO1_3</td></tr>
<tr class="separator:a967a470d2db12070ac476ff8997e8265"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b1081f2773dd2d71eb60ad09b047df"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a50b1081f2773dd2d71eb60ad09b047df">IOCON_ADC5PIN</a>&#160;&#160;&#160;PIO1_4</td></tr>
<tr class="separator:a50b1081f2773dd2d71eb60ad09b047df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff865b5d25493d76ccabacb194416c3a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#aff865b5d25493d76ccabacb194416c3a">IOCON_ADC6PIN</a>&#160;&#160;&#160;PIO1_10</td></tr>
<tr class="separator:aff865b5d25493d76ccabacb194416c3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a187f40bab597c43e0a8a4d62b6d1eb95"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a187f40bab597c43e0a8a4d62b6d1eb95">IOCON_ADC7PIN</a>&#160;&#160;&#160;PIO1_11</td></tr>
<tr class="separator:a187f40bab597c43e0a8a4d62b6d1eb95"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3fdaf3b8949082abe85a7e7083087eb7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#a3fdaf3b8949082abe85a7e7083087eb7">ADC_Init</a> ()</td></tr>
<tr class="separator:a3fdaf3b8949082abe85a7e7083087eb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac82add17365f81d83a1f17850be4854e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="adc_8h.html#ac82add17365f81d83a1f17850be4854e">ADC_IRQHandler</a> ()</td></tr>
<tr class="separator:ac82add17365f81d83a1f17850be4854e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>K. Joseph Hass </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Created: 2014-01-07T19:31:54-0500 </dd>
<dd>
Last modified: 2014-01-12T18:02:38-0500</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2014 Kenneth Joseph Hass</dd>
<dd>
This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</dd>
<dd>
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ae678d504181814806fe8acf281cb7c31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADC_BITS&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ADC resolution, in bits. </p>

</div>
</div>
<a class="anchor" id="ab1d0fe407755d6fc628d014d7d0bcd8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADC_CLK_FREQ&#160;&#160;&#160;1000000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The desired ADC clock frequency, in hertz. </p>
<p>For the LPC13xx and LPC11xx processors this value must be less than 4.5 MHz. Running the ADC at slower clocks can improve accuracy. </p>

</div>
</div>
<a class="anchor" id="a1c77a4467697f72f3d6ed3b5effd7182"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADC_VREF_MV&#160;&#160;&#160;3300</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ADC reference voltage, in mV. Here, same as the supply voltage. </p>

</div>
</div>
<a class="anchor" id="a501e37e951966e98511c9c1eb0c7d397"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CURRENT_CHANNEL&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies which ADC channel measures the battery current. </p>

</div>
</div>
<a class="anchor" id="a4a1f09871849e533aea252fc78a2aa84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC0PIN&#160;&#160;&#160;R_PIO0_11</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a267ec9fac11562467240f0b3627288a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC1PIN&#160;&#160;&#160;R_PIO1_0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="acc40c992fe2ad9bd0f6e7718c3acb3e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC2PIN&#160;&#160;&#160;R_PIO1_1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a506159826be18b45611deae145462433"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC3PIN&#160;&#160;&#160;R_PIO1_2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a967a470d2db12070ac476ff8997e8265"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC4PIN&#160;&#160;&#160;SWDIO_PIO1_3</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a50b1081f2773dd2d71eb60ad09b047df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC5PIN&#160;&#160;&#160;PIO1_4</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aff865b5d25493d76ccabacb194416c3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC6PIN&#160;&#160;&#160;PIO1_10</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a187f40bab597c43e0a8a4d62b6d1eb95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOCON_ADC7PIN&#160;&#160;&#160;PIO1_11</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a3ad11a109af35fa8de5e0b1b3e60142b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VOLTAGE_CHANNEL&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies which ADC channel measures the battery voltage. </p>

</div>
</div>
<a class="anchor" id="aa34423f95e31d610503eaa953906d93c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VREF_25_CHANNEL&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies which ADC channel is connected to the 2.5V reference. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3fdaf3b8949082abe85a7e7083087eb7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ADC_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the analog-to-digital converter. </p>
<p>Turn on power to the ADC by disabling its power-down bit in <code>PDRUNCFG</code> then enable its clock in <code>SYSAHBCLKCTRL</code>. Each of the pins used as an ADC input must then be reconfigured for the analog input function. </p>
<p>Select the desired ADC channels, turn on burst mode, and set the clock divider value in the ADC control register. Clear all other bits.</p>
<p>Enable ADC interrupts. Interrupt will occur when the highest-numbered channel finishes a conversion. Also enable the NVIC IRQ for the ADC.</p>

</div>
</div>
<a class="anchor" id="ac82add17365f81d83a1f17850be4854e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ADC_IRQHandler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ADC interrupt service routine. </p>
<p>The conversion from each of the three channels is read from the appropriate ADC data register. The variables <a class="el" href="charger_8h.html#a0142489055e8b3b737784a72afddf73b">RawCurrent</a>, <a class="el" href="charger_8h.html#a83e89a22da06d138a4a9373955d02d34">RawVoltage</a>, and <a class="el" href="charger_8h.html#a072b3046a3b425f96c26c3bb1a9376b8">FastVoltage</a> are the accumulator for three moving-average filters that perform low-pass filtering on the current and voltage samples. The voltage and current samples are not synchronized to the PWM signal so some samples will be taken when the switching transistor is conducting and some will be taken when it is not conducting. We need to average many samples to get reasonable measurements.</p>
<p>The ADC channel for the 2.5V voltage reference is also sampled but this data is discarded. In the future we should use this channel to calibrate the ADC, since the ADC's reference voltage is just the microcontroller's supply voltage. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="adc_8h.html">adc.h</a></li>
    <li class="footer">Generated on Mon Jan 13 2014 08:36:57 for BatteryCharger by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
